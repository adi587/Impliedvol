# Impliedvol
After learning about the shortcomings of the Black Scholes (BS) model I wanted to see how implied volatility varies between equities and fx. To do this I use the same files from my previous Binomialoption repository, specifically to calculate implied volatiltiy given option strikes and prices.
# Volatility surface model and training
As there are only a discrete select set of option strikes traded on the markets I need to create a model that can predict option prices for all strikes and maturity dates given market data. For the model I draw from (Dumas, Fleming and Whaley 1996) paper: $IV=a_0+a_1K+a_2T+a_3K^2+a_4KT+a_5T^2$ where $IV,K,T$ is implied volatility, strike and time to maturity respectively. The $a_i$ coefficients are to be determined from training the model on historical data. This model is useful as the quadratic nature will capture the 'smiling' nature of IV without overfitting (as would be seen with higher order polynomials). The market data to train the model was downloaded online for various strikes and expiration dates (setting up an API to dynamically retrieve market information would be unnecessarily time consuming for the purpose of this project). The model was trained using a linear regressor (mean squared distance loss function) after transforming the features into polynomial features. 
# Analysis
I first constructed volatility surfaces for Amazon (AMZN) options. The price of stock at training was 129.12 USD. I set the risk free rate to 0.05 matching treasury bill yields. The dividends rate was set to 0 (An online search shows amazons low divedend rate). The risk free rate and dividends do not same to have much effect on the IV values and shape so I wasnt too worried about using exact figures. I only use call options as by the put-call parity the shape of the IV curves should be unaffected. I selected a range of strikes and 5 different maturity dates (A total of 170 data points). To train the model I split the data as 0.8 for training and 0.2 for testing. The $R^2$ coefficient on train set was 0.84 and for test set it was $0.85$. This is a good coefficient of determination indicating the model does a good job at predicting the surfaces. I then plotted the surface for a range of points giving this 3D plot:

![image](https://github.com/adi587/Volatilitysurfaces/assets/63116085/f50a8a06-c947-47de-bfcc-ee51b1fff6df)

Note that the z-axis is the implied volatility. A clear curvature can be seen between the strike price and implied volatility. Also a less pronounced curve can be seen with the implied volatiltiy and time to maturity. To see this effect clearer IV is plotted again strike at for 1 month time to maturity and IV plotted against time at 133 strike.

# IV dependance on strike (AMZN)

![image](https://github.com/adi587/Volatilitysurfaces/assets/63116085/1816e2d5-a987-418e-8acb-bb65cf54cce3)

First on the IV and strike relation, the orange dotted line is to show the stock price at time of training. Before the 1987 crash, equity options like these did not exhibit volatility skews. The standard answer for this type of dependance between IV and strike is to use short-comings of the Black-Scholes model. Black-Scholes assumes the underlying asset to move in a lognormal distribution. This underpredicts the probability of larger price movements (tails of distribution) and so underprices low and high strike options. Therefore the market prices them higher than Black-Scholes predicts, giving a higher IV for strikes at the tails giving the volatility smile. This distribution of IV has higher IV for lower strikes than higher strikes which would mean (using the above reasoning) that there is a higher probability of a large downturn rather than upturn is price. This may be true as there are more ways for a business to rapidly lose value than increase value however I'm unsure if this is the main factor (should do some analysis on this). Alternatively the skew can come from demand in low strikes driving option prices higher. 

I spoke to a senior quant trader about this problem who believed the skew arises from insurance on positions. For example if a firm is long on amazon they may buy OTM put options at a low strike to try hedge against any large downfalls in the stocks price. This leads to an increased demand for low OTM puts driving the prices and IV up. Through put-call parity this also drives IV of call options up which skews lower strikes to have higher IV. The same arguement can be used for a firm that is short amazon. They may buy ITM calls to hedge against an upturn in the market and following the same logic as previously, this gives an increase IV at higher strikes. Finally the market is usually overall long rather than short so there is a higher demand for the 1st type of insurance rather than the second causing these lower strikes to have higher IV compared to higher strikes giving the volatility skew we see. This argument would also explain why the skew arised after 87 from traders being more risk averse and hedging there positions against large swings in price. 

The final distribution seen is likely a superposition of both these effects (and probably several other effects not mentioned here). A full statistical analysis of price movements of the underlying could be done to see how the underlying price distribution compares to the log-normal distribution. From there we can attempt to quantify how much this effect impacts the IV distribution seen (i.e if the price distribution is very clsoe to log-norma,l then we know the driving factor of the shape of IV is due to another effect). I might try do this in another project down the line. 

# IV dependance on time to maturirty (AMZN)

![image](https://github.com/adi587/Volatilitysurfaces/assets/63116085/6934c41d-76bc-430d-9264-31c6595132a8)

The time used in training set was ... ... . Looking at this graph we see IV decreasing with larger time to maturity. I was initially suprised by this behaviour however after some research I found an explanation. The downward curving nature is due to the market predicting that realised volatility (actual volatility of the underlying) will decrease in future. If the curve was upward facing the opposite would be true (similiar to bonds term structure). To confirm this we can look at amazon current volatility compared to historical (as volatility is usually mean reverting).
